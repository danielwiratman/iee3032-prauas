{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link rel="stylesheet" href="{% static 'ui/style.css' %}" />
    </head>
    <body>
        <h1 class="mainTitle">IEE3032 - PRAUAS</h1>
        <h2 class="mainTitle">By: Daniel Wiratman (202000205)</h2>
        <div class="container">
            <div class="box">
                <h1>PABRIK 1: Smart Farm</h1>
                <h2>SUBSISTEM 1: Susu Hewani dan Telur</h2>
                <p>Sensor Kadar Protein Susu</p>
                <p><span id="subsistem1-kadarproteinsusu"></span> g</p>
                <p>Sensor Kekentalan Susu</p>
                <p><span id="subsistem1-kekentalansusu"></span> cP</p>
                <p>Sensor Jumlah Kuning Telur</p>
                <p><span id="subsistem1-jumlahkuningtelur"></span> butir</p>
                <h2>SUBSISTEM 2: Daging Merah</h2>
                <p>Sensor Kemerahan Daging</p>
                <p><span id="subsistem2-kemerahandaging"></span> a*</p>
                <p>Sensor Kadar Lemak</p>
                <p><span id="subsistem2-kadarlemak"></span>%</p>
                <p>Sensor Kadar Air</p>
                <p><span id="subsistem2-kadarair"></span>%</p>
                <h2>SUBSISTEM 3: Daging Putih</h2>
                <p>Sensor Microbacteria</p>
                <p><span id="subsistem3-microbacteria"></span> mg/kg</p>
                <p>Sensor Kadar Protein</p>
                <p><span id="subsistem3-kadarprotein"></span>%</p>
                <p>Sensor Keasaman Daging</p>
                <p><span id="subsistem3-keasamandaging"></span> ph</p>
                <h2>AKTUATOR: Sensor Okupansi</h2>
                <p><span id="system1_hvac"></span></p>
            </div>
            <div class="box">
                <h1>PABRIK 2: Smart Plantation</h1>
                <h2>SUBSISTEM 1: Sumber Karbohidrat</h2>
                <p>Sensor Kadar Protein Susu</p>
                <p><span id="subsistem1-kadarproteinsusu"></span> g</p>
                <p>Sensor Kekentalan Susu</p>
                <p><span id="subsistem1-kekentalansusu"></span> cP</p>
                <p>Sensor Jumlah Kuning Telur</p>
                <p><span id="subsistem1-jumlahkuningtelur"></span> butir</p>
                <h2>SUBSISTEM 2: Sayuran</h2>
                <p>Sensor Kemerahan Daging</p>
                <p><span id="subsistem2-kemerahandaging"></span> a*</p>
                <p>Sensor Kadar Lemak</p>
                <p><span id="subsistem2-kadarlemak"></span>%</p>
                <p>Sensor Kadar Air</p>
                <p><span id="subsistem2-kadarair"></span>%</p>
                <h2>SUBSISTEM 3: Buah-Buahan</h2>
                <p>Sensor Microbacteria</p>
                <p><span id="subsistem3-microbacteria"></span> mg/kg</p>
                <p>Sensor Kadar Protein</p>
                <p><span id="subsistem3-kadarprotein"></span>%</p>
                <p>Sensor Keasaman Daging</p>
                <p><span id="subsistem3-keasamandaging"></span> ph</p>
                <h2>AKTUATOR: Sensor Okupansi</h2>
            </div>
            <div class="box">
                <h1>PABRIK 3: Smart Restaurant</h1>
                <h2>SUBSISTEM 1: Deteksi Musim</h2>
                <p><span id="system3_waterlevel"></span> mm</p>
                <h2>SUBSISTEM 2: Deteksi Hasil Penjualan Berfluktuasi</h2>
                <p><span id="system3_pressure"></span> Pa</p>
                <h2>SUBSISTEM 3: Deteksi Jumlah Pengunjung Restoran</h2>
                <p><span id="system3_temperature"></span>&deg;C</p>
                <h2>AKTUATOR: Water Valve</h2>
                <p><span id="system3_water_valve"></span></p>
            </div>
        </div>
        <script>
            function updateView(message) {
                const system1_temperature = JSON.parse(
                    message["system1_temperature"]
                );
                document.querySelector("#system1_temperature").innerHTML =
                    system1_temperature[0].fields.value;

                const system1_humidity = JSON.parse(
                    message["system1_humidity"]
                );
                document.querySelector("#system1_humidity").innerHTML =
                    system1_humidity[0].fields.value;

                const system1_occupancy = JSON.parse(
                    message["system1_occupancy"]
                );
                document.querySelector("#system1_occupancy").innerHTML =
                    system1_occupancy[0].fields.value;

                const system2_ph = JSON.parse(message["system2_ph"]);
                document.querySelector("#system2_ph").innerHTML =
                    system2_ph[0].fields.value;
                const system2_turbiditas = JSON.parse(
                    message["system2_turbiditas"]
                );
                document.querySelector("#system2_turbiditas").innerHTML =
                    system2_turbiditas[0].fields.value;
                const system2_konduktivitas = JSON.parse(
                    message["system2_konduktivitas"]
                );
                document.querySelector("#system2_konduktivitas").innerHTML =
                    system2_konduktivitas[0].fields.value;
                const system3_waterlevel = JSON.parse(
                    message["system3_waterlevel"]
                );
                document.querySelector("#system3_waterlevel").innerHTML =
                    system3_waterlevel[0].fields.value;
                const system3_pressure = JSON.parse(
                    message["system3_pressure"]
                );
                document.querySelector("#system3_pressure").innerHTML =
                    system3_pressure[0].fields.value;
                const system3_temperature = JSON.parse(
                    message["system3_temperature"]
                );
                document.querySelector("#system3_temperature").innerHTML =
                    system3_temperature[0].fields.value;
                const system1_hvac = message["system1_hvac"] ? "ON" : "OFF";
                const system2_chemical_pump = message["system2_chemical_pump"]
                    ? "ON"
                    : "OFF";
                const system3_water_valve = message["system3_water_valve"]
                    ? "ON"
                    : "OFF";

                document.querySelector("#system1_hvac").innerHTML =
                    system1_hvac;
                document.querySelector("#system2_chemical_pump").innerHTML =
                    system2_chemical_pump;
                document.querySelector("#system3_water_valve").innerHTML =
                    system3_water_valve;
            }

            function getData() {
                fetch(`http://${window.location.host}/api/sensor/`)
                    .then((res) => res.json())
                    .then((data) => updateView(data));
            }

            setInterval(function () {
                const e = getData();
            }, 1000);
        </script>
    </body>
</html>

